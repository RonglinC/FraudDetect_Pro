{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h2>FraudDetectorPro Chatbot</h2>
  <div id="chatbot-messages" style="height:400px; overflow-y:auto; border:1px solid #ccc; padding:10px; border-radius:8px; margin-bottom:10px;">
  </div>
  <div class="input-group mb-3">
    <input type="text" id="chatbot-message" class="form-control" placeholder="Type a message...">
    <button id="chatbot-send" class="btn btn-primary">Send</button>
  </div>
  <a href="{{ url_for('homepage') }}" class="btn btn-secondary">Back to Home</a>
</div>

<script>
const chatbotMessages = document.getElementById("chatbot-messages");
const chatbotMessageInput = document.getElementById("chatbot-message");
const chatbotSendButton = document.getElementById("chatbot-send");

chatbotSendButton.addEventListener("click", async () => {
  const message = chatbotMessageInput.value;
  if (!message) return;

  // Display user message
  const userMessage = document.createElement("div");
  userMessage.textContent = `You: ${message}`;
  chatbotMessages.appendChild(userMessage);

  // Send message to backend
  try {
    const response = await fetch("/chatbot_api", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message }),
    });
    const data = await response.json();

    // Display chatbot response
    const botMessage = document.createElement("div");
    botMessage.textContent = `Bot: ${data.response || data.error}`;
    chatbotMessages.appendChild(botMessage);
  } catch (error) {
    const errorMessage = document.createElement("div");
    errorMessage.textContent = "Bot: Error connecting to backend.";
    chatbotMessages.appendChild(errorMessage);
  }

  chatbotMessageInput.value = "";
});
</script>
{% endblock %}
